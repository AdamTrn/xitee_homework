- name: Run compose using project directory
  hosts: wp_servers
  gather_facts: false
  become: true
  tasks:
    - name: Ensure docker is installed
      ansible.builtin.apt:
        name:
          - docker-compose-v2
          - docker
        state: present

    - name: Ensure /etc/docker exists
      ansible.builtin.file:
        path: /etc/docker
        state: directory

    - name: Copy compose file to host
      ansible.builtin.copy:
        src: templates/compose.yml.j2
        dest: /etc/docker/compose.yml
        mode: '644'

    - name: Tear down existing containers
      community.docker.docker_compose_v2:
        project_src: /home/ansible
        state: absent

    - name: Create new containers
      community.docker.docker_compose_v2:
        project_src: /home/ansible
        state: present
